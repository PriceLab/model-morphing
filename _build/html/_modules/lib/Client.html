<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>lib.Client &mdash; Model Morphing b1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Model Morphing b1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Model Morphing b1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lib.Client</h1><div class="highlight"><pre>
<span class="c"># import necesary services</span>
<span class="kn">from</span> <span class="nn">biokbase.workspace.client</span> <span class="kn">import</span> <span class="n">Workspace</span>
<span class="kn">from</span> <span class="nn">biokbase.workspace.client</span> <span class="kn">import</span> <span class="n">ServerError</span>
<span class="kn">from</span> <span class="nn">biokbase.fbaModelServices.Client</span> <span class="kn">import</span> <span class="n">fbaModelServices</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">Helpers</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">Morph</span> <span class="kn">import</span> <span class="n">Morph</span>

<span class="c"># This module is the Client for the model morphing service. It performs</span>
<span class="c"># operations necessary to morphing models. It is a module, performing</span>
<span class="c"># functions on models to morph them from a source model to a target genome</span>
<span class="c"># according to the (TODO: Name Algorithm) Algorithm designed by members of</span>
<span class="c"># the Price lab at the Institute for Systems Biology</span>
<span class="c">#</span>
<span class="c"># Abstraction Function: a Client module for using the Morphing service,</span>
<span class="c"># providing a user with functions for morphing models and analyzing the</span>
<span class="c"># results.</span>

<span class="c"># A global value for running requirement and representation checks with each method</span>
<span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">_init_clients</span><span class="p">():</span>
    <span class="c"># Get workspace service URL parameter</span>
    <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s">&quot;./urls/.kbase_workspaceURL&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ws_client</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c"># Get FBA Model Services URL parameter</span>
    <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s">&quot;./urls/.kbase_fbaModelServicesURL&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">fba_client</span> <span class="o">=</span> <span class="n">fbaModelServices</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ws_client</span><span class="p">,</span> <span class="n">fba_client</span>

<div class="viewcode-block" id="prepare_supermodel"><a class="viewcode-back" href="../../modules.html#lib.Client.prepare_supermodel">[docs]</a><span class="k">def</span> <span class="nf">prepare_supermodel</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">fill_src</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Composition of the first several steps in the algorithm</span>

<span class="sd">    1) Fill the source model to media using probabilistic gapfilling (can be skipped if fill_src keyword arg is set to False)</span>
<span class="sd">    2) Translate the src_model to a pouplate morph.trans_model</span>
<span class="sd">    3) Draft reconstruction of target genome fills morph.recon_model field</span>
<span class="sd">    4) label reactions in the morph (populates morph.rxn_labels)</span>
<span class="sd">    5) Builds a super_model and puts it in the morph.model field. The model is now ready for the process_reactions function</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.probanno, morph.probannows form a valid ObjectIdentity for a readable RxnProbs object in KBase</span>
<span class="sd">        - morph.src_model, morph.src_modelws form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.media, morph.mediaws form a valid ObjectIdentity for a readable media object in KBase</span>
<span class="sd">        - morph.genome, morph.genomews form a valid ObjectIdentity for a readable genome object in KBase</span>
<span class="sd">        - morph.protcomp, morph.protcompws form a valid ObjectIdentity for a readable protein comparison object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        An initialized Morph with the following Requirements:</span>
<span class="sd">            - morph.ws_id is a valid KBase workspace_id that user has permission</span>
<span class="sd">            to write to</span>
<span class="sd">            - morph has valid object identities for src_model, genome, probanno,</span>
<span class="sd">            protcomp (These 4 are object_ids, their ___ws counterparts are workspace_ids</span>
<span class="sd">            of user readable workspaces)</span>
<span class="sd">    fill_src: boolean,optional</span>
<span class="sd">        a boolean indicating that the src_model should first be filled using probabilistic gapfilling</span>
<span class="sd">        Optional, default is true.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        A Morph with the following state changes:</span>
<span class="sd">            - morph.model has the object_id of the super_model in KBase</span>
<span class="sd">            - morph.rxn_labels has the labels for the reactions in the super</span>
<span class="sd">            model</span>
<span class="sd">            - morph.probhash has the probability hash for reactions related to</span>
<span class="sd">            Target genome</span>
<span class="sd">            - morph.trans_model has the object_id of the translated model</span>
<span class="sd">            - morph.recon model has the object_id of the reconstruction of</span>
<span class="sd">            Target Genome</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Suppose you have a morph initialized like so: (this is the output of Helpers.make_morph() )</span>

<span class="sd">    &gt;&gt;&gt; morph = make_morph()</span>

<span class="sd">        probannows: 9145</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 9145</span>
<span class="sd">        protcompws: 9145</span>
<span class="sd">        src_model: 19</span>
<span class="sd">        media: 18</span>
<span class="sd">        removed_ids: None</span>
<span class="sd">        mediaws: 9145</span>
<span class="sd">        trans_model: None</span>
<span class="sd">        probhash: None</span>
<span class="sd">        genomews: 9145</span>
<span class="sd">        essential_ids: None</span>
<span class="sd">        genome: 3</span>
<span class="sd">        rxn_labels: None</span>
<span class="sd">        model: None</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: None</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        protcomp: 6</span>

<span class="sd">    A call to Client.prepare_supermodel(morph) will return a morph of this sort of form:</span>

<span class="sd">    &gt;&gt;&gt; morph = Client.prepare_supermodel(morph)</span>

<span class="sd">        probannows: 9145</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 9145</span>
<span class="sd">        protcompws: 9145</span>
<span class="sd">        src_model: 19</span>
<span class="sd">        media: 18</span>
<span class="sd">        removed_ids: None</span>
<span class="sd">        mediaws: 9145</span>
<span class="sd">        trans_model: 3</span>
<span class="sd">        probhash: [u&#39;rxn00001&#39; ... u&#39;rxn97854&#39;]</span>
<span class="sd">        genomews: 9145</span>
<span class="sd">        essential_ids: None</span>
<span class="sd">        genome: 3</span>
<span class="sd">        rxn_labels: [&#39;gene-no-much&#39;, &#39;gene-match&#39;, &#39;recon&#39;, &#39;no-gene&#39;]</span>
<span class="sd">        model: 5</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: 4</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        protcomp: 6</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fill_src_to_media</span>
<span class="sd">    translate_features</span>
<span class="sd">    reconstruct_genome</span>
<span class="sd">    label_reactions</span>
<span class="sd">    build_supermodel</span>

<span class="sd">    This functions post condition preps the morph for the Client.process_reactions(morph) function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fill_src</span><span class="p">):</span>
        <span class="n">morph</span> <span class="o">=</span> <span class="n">fill_src_to_media</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">translate_features</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">reconstruct_genome</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">label_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">build_supermodel</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="fill_src_to_media"><a class="viewcode-back" href="../../modules.html#lib.Client.fill_src_to_media">[docs]</a><span class="k">def</span> <span class="nf">fill_src_to_media</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a morph and probanno gap-fills the source model to given media</span>

<span class="sd">    Fills a source model to a given media. This is an important step if the source model does not grow initially on the media. NOTE: THIS MODIFIES SRC_MODEL IN THE MORPH</span>
<span class="sd">    However, it does not overwrite the actual source model in KBase. It is imported to morph.ws_id, and morph.src_modelws is changed to match ws_id. Therefore, the data of the source</span>
<span class="sd">    model is preserved as is, but the reference to its location in KBase is lost from the morph.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.src_model, morph.src_modelws form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.media, morph.mediaws form a valid ObjectIdentity for a readable media object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        A morph for which you want to gap-fill the source model to it&#39;s given media</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph object where morph.src_model, morph.src_modelws forms a valid ObjectIdentity for a</span>
<span class="sd">        readable/writable KBase model object (the gapfilled version of parameter&#39;s morph.src_model)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    exception: MediaException</span>
<span class="sd">        (TO BE IMPLEMENTED) An exception indicating that the given media could not be gapfilled in such a way that model objective function exceeds 0</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (Only relevant attributes shown):</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 9145</span>
<span class="sd">        src_model: 19</span>
<span class="sd">        media: 18</span>
<span class="sd">        mediaws: 9145</span>
<span class="sd">        ws_id: 11444</span>

<span class="sd">    &gt;&gt;&gt; morph = fill_src_to_media(morph)</span>

<span class="sd">    Produces something like so:</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 11444</span>
<span class="sd">        src_model: 2</span>
<span class="sd">        media: 18</span>
<span class="sd">        mediaws: 9145</span>
<span class="sd">        ws_id: 11444</span>

<span class="sd">    Note: The reference to the old source model is lost from the model, but it still exists at it&#39;s previous KBase location un-modified</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Copy the source model to the new workspace</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">srccopy</span> <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">({</span><span class="s">&#39;from&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;wsid&#39;</span><span class="p">:</span><span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span><span class="p">,</span> <span class="s">&#39;objid&#39;</span><span class="p">:</span><span class="n">morph</span><span class="o">.</span><span class="n">src_model</span><span class="p">},</span> <span class="s">&#39;to&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;wsid&#39;</span><span class="p">:</span><span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;srccopy&#39;</span><span class="p">}})</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span> <span class="o">=</span> <span class="n">srccopy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span> <span class="o">=</span> <span class="n">srccopy</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="c"># Gapfill the model and reset the src_model and src_modelws attributes of</span>
    <span class="c"># the morph</span>
    <span class="n">fba_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;media&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">media</span><span class="p">,</span> <span class="s">&#39;media_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">mediaws</span><span class="p">}</span>
    <span class="n">gap_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;probabilisticAnnotation&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probanno</span><span class="p">,</span> <span class="s">&#39;probabilisticAnnotation_workspace&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probannows</span><span class="p">,</span> <span class="s">u&#39;formulation&#39;</span><span class="p">:</span> <span class="n">fba_formulation</span><span class="p">}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">u&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span><span class="p">,</span> <span class="s">u&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span><span class="p">,</span> <span class="s">u&#39;out_model&#39;</span> <span class="p">:</span> <span class="s">u&#39;source_filled&#39;</span><span class="p">,</span> <span class="s">u&#39;workspace&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">u&#39;formulation&#39;</span> <span class="p">:</span> <span class="n">gap_formulation</span><span class="p">,</span> <span class="s">u&#39;integrate_solution&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">u&#39;gapFill&#39;</span> <span class="p">:</span> <span class="s">u&#39;gf&#39;</span><span class="p">}</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">gapfill_model</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span></div>
<div class="viewcode-block" id="translate_features"><a class="viewcode-back" href="../../modules.html#lib.Client.translate_features">[docs]</a><span class="k">def</span> <span class="nf">translate_features</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the features in the source model to matches in the target genome</span>

<span class="sd">    NOTE: The translated model will lose reactions in the source model that did not have matching features</span>
<span class="sd">    and is not guaranteed to be useful in FBA simulation.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.src_model, morph.src_modelws form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.protcomp, morph.protcompws form a valid ObjectIdentity for a readable protein comparison object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        A morph for which you want to produce a translated model to be referenced by morph.trans_model</span>
<span class="sd">        (preceeds reaction labelling)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph object where morph.trans_model, morph.ws_id forms a valid ObjectIdentity for a</span>
<span class="sd">        readable/writable KBase model object (the translation of morph.src_model)</span>
<span class="sd">    &quot;&quot;&quot;</span>
 <span class="c"># import necesary services# import necesary service</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">protcomp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;protcomp is None&quot;</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">protcompws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;protcompws is None&quot;</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;src_model is None&quot;</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;src_modelws is None&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">trans_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;keep_nogene_rxn&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;protcomp&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">protcomp</span><span class="p">,</span> <span class="s">&#39;protcomp_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">protcompws</span><span class="p">,</span> <span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">}</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">trans_model</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">translate_fbamodel</span><span class="p">(</span><span class="n">trans_params</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="reconstruct_genome"><a class="viewcode-back" href="../../modules.html#lib.Client.reconstruct_genome">[docs]</a><span class="k">def</span> <span class="nf">reconstruct_genome</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a reconstruction from morph.genome and saves it in morph.recon_model</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.genome, morph.genomews form a valid ObjectIdentity for a genome object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        A morph for which you want to build a reconstruction referenced by morph.recon_model</span>
<span class="sd">        (preceeds reaction labelling)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph object where morph.recon_model, morph.ws_id forms a valid ObjectIdentity for a</span>
<span class="sd">        readable/writable KBase model object (the draft reconstruction of morph.genome)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (only relevant attributes shown):</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        genomews: 9145</span>
<span class="sd">        genome: 3</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: None</span>

<span class="sd">    &gt;&gt;&gt; morph = Client.reconstruct_genome(morph)</span>

<span class="sd">    would produce something like this:</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        genomews: 9145</span>
<span class="sd">        genome: 3</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: 4</span>

<span class="sd">    Where morph.recon_model, morph.ws_id forms a valid ObjectIdentity for a readable/writable KBase model object (the draft reconstruction of morph.genome)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">genome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;genome is None&quot;</span>
        <span class="k">assert</span> <span class="n">morph</span><span class="o">.</span><span class="n">genomews</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;genomews is None&quot;</span>
    <span class="n">recon_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;genome&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">genome</span><span class="p">,</span> <span class="s">&#39;genome_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">genomews</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">}</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">recon_model</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">genome_to_fbamodel</span><span class="p">(</span><span class="n">recon_params</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<span class="k">def</span> <span class="nf">_get_objects</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is used by the label reactions function and is not intended for end user use, proceed with caution</span>

<span class="sd">    Gets the model and probanno objects associated with the morph.</span>

<span class="sd">    Populates morph.objects with a dictionary of objects. Three are FBA Models, with keys &#39;source_model&#39;, &#39;recon_model&#39;, &#39;trans_model&#39;.</span>
<span class="sd">    The last is a ProbAnno RxnProbs object, keyed &#39;probanno&#39;. Corresponding entries are put in a dictionary morph.info, with the object_info</span>
<span class="sd">    as it is returned from the workspace service&quot;</span>

<span class="sd">    Requires:</span>
<span class="sd">        src_model, trans_model, recon_model, and probanno are all attributes of morph and valid IDs for KBase objects. src_modelws and probannows are valid</span>
<span class="sd">        workspace ID&#39;s corresponding with src_model and probanno attributes of morph to form valid ObjectIdentity&#39;s.</span>

<span class="sd">   :param morph: the Morph object with the associated objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="c"># make the objects and info dictionaries</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="n">morph</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="n">morph</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c"># Get the src_model</span>
    <span class="n">obj</span>  <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s">&#39;objid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_model</span><span class="p">,</span> <span class="s">&#39;wsid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">src_modelws</span><span class="p">}])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;source_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;source_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">]</span>
    <span class="c"># Get the translate model</span>
    <span class="n">obj</span>  <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s">&#39;objid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">trans_model</span><span class="p">,</span> <span class="s">&#39;wsid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">}])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;trans_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;trans_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">]</span>
    <span class="c"># Get the recon model</span>
    <span class="n">obj</span>  <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s">&#39;objid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">recon_model</span><span class="p">,</span> <span class="s">&#39;wsid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">}])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;recon_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;recon_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">]</span>
    <span class="c"># Get the probanno</span>
    <span class="n">obj</span>  <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s">&#39;objid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probanno</span><span class="p">,</span> <span class="s">&#39;wsid&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probannows</span><span class="p">}])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;probanno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;probanno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">]</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">probhash</span><span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;probanno&#39;</span><span class="p">][</span><span class="s">&#39;reaction_probabilities&#39;</span><span class="p">]:</span>
        <span class="n">morph</span><span class="o">.</span><span class="n">probhash</span><span class="p">[</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
<div class="viewcode-block" id="label_reactions"><a class="viewcode-back" href="../../modules.html#lib.Client.label_reactions">[docs]</a><span class="k">def</span> <span class="nf">label_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Labels morph&#39;s reactions from translated model, reconstruction, and source</span>

<span class="sd">    Populates the rxn_labels attribute in the Morph object with a Dictionary of four dictionaries of reactrion_id -&gt; value tuples.</span>
<span class="sd">    The first level dicts are named with the keys:</span>
<span class="sd">        - gene-match</span>
<span class="sd">        - gene-no-match</span>
<span class="sd">        - no-gene</span>
<span class="sd">        - recon</span>
<span class="sd">    Populates morph.probhash with a dictionary of compartment-truncated reaction_ids to their probability relative to genome in question</span>
<span class="sd">        (derived from morph.probanno).</span>
<span class="sd">    Also populates morph.objects, morph.info with data from KBase objects (advanced use)</span>

<span class="sd">    Technical Details (Consult if you are encountering issues):</span>
<span class="sd">    For simplicity, an end user can treat the interiors of each dictionary like a set of reaction ids, but it is important to note the</span>
<span class="sd">    this is actually a nested dictionary with entries of the form: reaction_id -&gt; (model_index, probability)</span>
<span class="sd">    Thus, some set like behavior works, but some doesn&#39;t, the user must account for the fact that these are dictionaries:</span>

<span class="sd">        &gt;&gt;&gt;&#39;rxn09073_c0&#39; in morph.rxn_labels[&#39;gene-no&#39;match&#39;]</span>

<span class="sd">            works and returns True or False, indicating whether or not rxn09073_c0 is a gene-no-match reaction</span>

<span class="sd">        &gt;&gt;&gt;morph.rxn_labels[&#39;gene-match&#39;].add(&#39;rxn00456_c0&#39;)</span>

<span class="sd">        fails and throws an exception. add() is a set method and can&#39;t be used on dictionaries. (You could set an</span>
<span class="sd">        entry with real or arbitrary value to get around this if you really wished)</span>

<span class="sd">    Each inner dictionary is keyed with reaction_ids, hashed to tuples as such: (model_index, probability)</span>
<span class="sd">    Where reaction_id is a kbase reaction id with the compartment info appended to the end (e.g. rxn01316_c0),</span>
<span class="sd">    model_index is the index of the reaction in the objects[&#39;x_model&#39;][modelreactions] list, and the probability</span>
<span class="sd">    is the reaction probability associated with each reaction from the probanno object. Reactions not in ProbAnno</span>
<span class="sd">    are given an arbitrary probability of -1.0</span>

<span class="sd">    Example evaluations:</span>
<span class="sd">    rxn_labels[&#39;gene-no-match&#39;][&#39;rxn01316_c0&#39;][0] evaluates to the index of rxn01316_c0 in morph.objects[&#39;trans_model&#39;][&#39;modelreactions&#39;]</span>
<span class="sd">    rxn_labels[&#39;gene-no-match&#39;][&#39;rxn01316_c0&#39;][1] evaluates to the reaction probability of rxn01316_c0</span>
<span class="sd">    &#39;rxn01316_c0&#39; in rxn_labels[&#39;gene-no-match&#39;] will evaluate True if the reaction is a gene-no-match reaction (an inner dict key)</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.probanno, morph.probannows form a valid ObjectIdentity for a readable RxnProbs object in KBase</span>
<span class="sd">        - morph.src_model, morph.src_modelws form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.recon_model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.trans_model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a readable/writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        the morph fo which you want to generate reaction labels</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph in which morph.rxn_labels holds a dictionary with the keys &#39;gene-match&#39;, gene-no-match&#39;, &#39;recon&#39;</span>
<span class="sd">        and &#39;no-gene&#39;. The value of each key holds a dictionary with 0 or more entries of the form:</span>
<span class="sd">            reaction_id -&gt; (model_index, probability)</span>
<span class="sd">        morph.probhash contains a dictionary of reaction_ids (COMPARTMENT TRUNCATED) mapped to their probabilities</span>
<span class="sd">            e.g. rxn09876 -&gt; 0.04545339</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (only relevant attricutes shown):</span>

<span class="sd">        probannows: 9145</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 9145</span>
<span class="sd">        src_model: 19</span>
<span class="sd">        trans_model: 3</span>
<span class="sd">        probhash: None</span>
<span class="sd">        rxn_labels: None</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: 4</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.objects = None</span>
<span class="sd">        morph.info = None</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.label_reactions(morph)</span>

<span class="sd">    would produce something like:</span>

<span class="sd">        probannows: 9145</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        src_modelws: 9145</span>
<span class="sd">        src_model: 19</span>
<span class="sd">        trans_model: 3</span>
<span class="sd">        probhash: [&#39;rxn05653&#39;, &#39;rxn12345&#39;, rxn59595&#39;, &#39;rxn45644&#39; ... (more)]</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        recon_model: 4</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.objects = [&#39;source_model&#39;, &#39;recon_model&#39;, &#39;trans_model&#39;, &#39;probanno&#39;]</span>
<span class="sd">        morph.info = [&#39;source_model&#39;, &#39;recon_model&#39;, &#39;trans_model&#39;, &#39;probanno&#39;]</span>

<span class="sd">    These could be examined like so:</span>

<span class="sd">    &gt;&gt;&gt;morph.rxn_labels[&#39;no-gene&#39;].keys()[1]</span>
<span class="sd">    u&#39;rxn10316_c0&#39;</span>

<span class="sd">    &gt;&gt;&gt;morph.rxn_labels[&#39;no-gene&#39;][&#39;rxn10316_c0&#39;][1]</span>
<span class="sd">    0.444456666959</span>

<span class="sd">    &gt;&gt;&gt;&#39;rxn10316_c0&#39; in morph.rxn_labels[&#39;no-gene&#39;]</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">_get_objects</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">label_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c"># create local vars for parts of the morph</span>
    <span class="n">trans_model</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;trans_model&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;source_model&#39;</span><span class="p">]</span>
    <span class="n">recon</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;recon_model&#39;</span><span class="p">]</span>
    <span class="n">probanno</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;probanno&#39;</span><span class="p">]</span>
    <span class="c"># create the rxn_labels dictionary</span>
    <span class="n">rxn_labels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(),</span> <span class="s">&#39;gene-match&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(),</span> <span class="s">&#39;no-gene&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(),</span> <span class="s">&#39;recon&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">()}</span>
    <span class="c"># Build a hash of rxn_ids to probability to save look up time</span>
    <span class="n">prob_hash</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">probanno</span><span class="p">[</span><span class="s">&#39;reaction_probabilities&#39;</span><span class="p">]:</span>
        <span class="n">prob_hash</span><span class="p">[</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c"># label gene-match and no-gene from translation</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trans_model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">])):</span>
        <span class="c">#anni e.g. rxn_id = rxn01316_c0</span>
        <span class="n">mdlrxn</span> <span class="o">=</span> <span class="n">trans_model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rxn_id</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># -1 index gets the last in the list</span>
        <span class="n">rxn_prot</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;modelReactionProteins&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rxn_prot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxn_prot</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modelReactionProteinSubunits&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rxn_prot</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;note&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;spontaneous&#39;</span> <span class="ow">and</span> <span class="n">rxn_prot</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;note&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;universal&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prob_hash</span><span class="p">[</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-match&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prob_hash</span><span class="p">[</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-match&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c"># Label gene-no-match as those unique to model compared with translation</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">])):</span>
        <span class="n">mdlrxn</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rxn_id</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># -1 index gets the last in the list</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rxn_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-match&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rxn_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prob_hash</span><span class="p">[</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c"># label recon as those unique to recon compared with model (model = gene-match + gene-no-match + no-gene)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recon</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">])):</span>
        <span class="n">mdlrxn</span> <span class="o">=</span> <span class="n">recon</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rxn_id</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># -1 index gets the last in the list</span>
        <span class="c"># if the recon reaction is already in the model</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rxn_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-match&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rxn_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">rxn_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;recon&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prob_hash</span><span class="p">[</span><span class="n">rxn_id</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;recon&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span> <span class="o">=</span> <span class="n">rxn_labels</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="build_supermodel"><a class="viewcode-back" href="../../modules.html#lib.Client.build_supermodel">[docs]</a><span class="k">def</span> <span class="nf">build_supermodel</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets morph.model to a superset of all reactions in morph.rxn_labels</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.rxn_labels is a dictionary with the four keys [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;recon&#39;, &#39;no-gene&#39;],</span>
<span class="sd">        and it&#39;s values are dictionaries with entries of the form: reaction_id -&gt; (model_index, probability)</span>
<span class="sd">        - morph.objects contains entries for the &#39;source_model&#39; and &#39;recon_model&#39; with data for the models in KBase (this</span>
<span class="sd">        is the output of the label_reactions(morph) function)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        The morph for which you want to build a super_model (initializing morph.model)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph object where morph.model, morph.ws_id forms a valid ObjectIdentity for a</span>
<span class="sd">        readable/writable KBase model object (the super-model)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph like so (only relevant attributes shown):</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        trans_model: 3</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.objects = [&#39;source_model&#39;, &#39;recon_model&#39;, &#39;trans_model&#39;, &#39;probanno&#39;]</span>
<span class="sd">        morph.model = None</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.build_supermodel(morph)</span>

<span class="sd">    would produce something like this:</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        trans_model: 3</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.objects = [&#39;source_model&#39;, &#39;recon_model&#39;, &#39;trans_model&#39;, &#39;probanno&#39;]</span>
<span class="sd">        morph.model = 5</span>

<span class="sd">    Where morph.model, morph.ws_id forms a valid ObjectIdentity for a model object in KBase (the super model)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">super_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;source_model&#39;</span><span class="p">]</span>
    <span class="n">recon</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;recon_model&#39;</span><span class="p">]</span>
    <span class="n">super_rxns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c"># Add the GENE_NO_MATCH reactions:</span>
    <span class="k">for</span> <span class="n">rxn_id</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">]:</span>
        <span class="c"># morph.rxn_labels[&#39;gene-no-match&#39;][0] gives the index of the reaction in the model[&#39;modelreactions&#39;] list to make this look up O(1) instead of O(n)</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c">#TODO: See what more you can fix/add (gpr?)</span>
        <span class="n">super_rxns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">reaction</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reaction</span><span class="p">[</span><span class="s">&#39;direction&#39;</span><span class="p">],</span> <span class="s">&#39;GENE_NO_MATCH&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">reaction</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
    <span class="c"># Add the recon reactions:</span>
    <span class="k">for</span> <span class="n">rxn_id</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;recon&#39;</span><span class="p">]:</span>
        <span class="c"># morph.rxn_labels[&#39;recon&#39;][0] gives the index of the reaction in the model[&#39;modelreactions&#39;] list to make this look up O(1) instead of O(n)</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="n">recon</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;recon&#39;</span><span class="p">][</span><span class="n">rxn_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c">#TODO: See what more you can fix/add (gpr?)</span>
        <span class="n">super_rxns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">reaction</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reaction</span><span class="p">[</span><span class="s">&#39;direction&#39;</span><span class="p">],</span> <span class="s">&#39;recon&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">reaction</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">add_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">trans_model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="s">&#39;super_model&#39;</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="n">super_rxns</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="removal_list"><a class="viewcode-back" href="../../modules.html#lib.Client.removal_list">[docs]</a><span class="k">def</span> <span class="nf">removal_list</span><span class="p">(</span><span class="n">rxn_dict</span><span class="p">,</span> <span class="n">list_range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a removal list from the rxn_dict (e.g. morph.rxn_labels[&#39;no-gene&#39;])</span>

<span class="sd">    Accepts a dictionary of reactions -&gt; (index, probability) as is given by morph.rxn_labels[label] and returns a sorted</span>
<span class="sd">    list of tuples that can be passed as the rxn_list parameter to the process_reactions function. This allows for processing</span>
<span class="sd">    of only some reactions from the model at a time. Tuples are in the form (reaction_id, index, probability). Setting the range keyword</span>
<span class="sd">    arg returns only a subset of the sorted list given by the index range passed in as a tuple (start, end).</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - rxn_dict is of a form analagous to rxn_labels[key]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rxn_dict: dict</span>
<span class="sd">        A dictionary of the form specified in rxn_labels[key] (see above description)</span>
<span class="sd">    list_range: tuple, optional. (start, end)</span>
<span class="sd">        A range within the list once it is sorted by probability (start inclusive, end exclusive)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        an sorted list of reactions to remove (sorted from low import probability to high</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a rxn_dict with 4 entries (shown below) and list_range of (0, 3)</span>
<span class="sd">        &gt;&gt;&gt;rxn_dict = { &#39;rxn00001_c0&#39;: (3, 0.2453)</span>
<span class="sd">                     &#39;rxn03035_c0&#39;: (78, 0.8744)</span>
<span class="sd">                     &#39;rxn00451_c0&#39;: (32, 0.0004)</span>
<span class="sd">                     &#39;rxn00602_c0&#39;: (9, 0.0056) }</span>

<span class="sd">        &gt;&gt;&gt;rxn_list = Client.removal_list(rxn_dict, list_range=(0, 3))</span>

<span class="sd">    rxn_list would evaluate to: [(&#39;rxn00451_c0&#39;, (32, 0.0004)), (&#39;rxn00602_c0&#39;, (9, 0.0056)), (&#39;rxn00001_c0, (3, 0.2453))]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Sort by probanno. items() returns (K, V=(model_index, prob))</span>
    <span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">removal_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rxn_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">get_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">list_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">list_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">list_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">removal_list</span>
</div>
<div class="viewcode-block" id="process_reactions"><a class="viewcode-back" href="../../modules.html#lib.Client.process_reactions">[docs]</a><span class="k">def</span> <span class="nf">process_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">process_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">get_count</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts removal of rxn_list reactions from morph (i.e. morph.rxn_labels[label])</span>

<span class="sd">    Attempts removal of each reaction , keeping it only if it is essential to the objective function.</span>
<span class="sd">    Populates morph.essential_ids with the reaction_ids that could not be removed without breaking the model.</span>
<span class="sd">    morph.removed_ids is populated with the ids of the reactions that were removed. Both are populated as a dictionary of</span>
<span class="sd">    reaction_ids to their model_index and probability (like the entries in rxn_labels).</span>
<span class="sd">        e.g. reaction_id -&gt; (model_index, probability)</span>

<span class="sd">    if rxn_list is None, the function removes (in low to high probability order) gene-no-match reactions followed by no-gene reactions</span>

<span class="sd">    Controlling name and process_count parameters allows the user tocontrol the number of models created in the morph.ws_id</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - if rxn_list is None, rxn_labels[&#39;gene-no-match&#39;] and rxn_labels[&#39;no-gene&#39;] must be dictionaries</span>
<span class="sd">        with 0 or more entries of the form reaction_id -&gt; (model_index, probability)</span>
<span class="sd">        - morph.model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        The morph containing the model (morph.model) from which reactions will be removed</span>
<span class="sd">    rxn_list: list, optional</span>
<span class="sd">        A sorted list of tuples of the form (reaction_id, (model_index, probability)) which will be processed from morph,model</span>
<span class="sd">        (form is the output of removal_list() function)</span>
<span class="sd">        (if left out, all gene-no-match follwed by all no-gene reactions will be processed in low to high likelihood order)</span>
<span class="sd">    name: String, optional</span>
<span class="sd">        Setting name will begin all output model names with name. Default is MM</span>
<span class="sd">        output models are named as follows: str(name) + &#39;-&#39; + str(process_count)</span>
<span class="sd">    process_count: int, optional</span>
<span class="sd">        A number indicating how many reactions have been processed so far, used in nameing output models. Default is 0.</span>
<span class="sd">        output models are named as follows: str(name) + &#39;-&#39; + str(process_count)</span>
<span class="sd">    get_count: Boolean, optional</span>
<span class="sd">        A Boolean flag indicating whether the process_count should be returned with the morph (as a tuple). Used when not processing all</span>
<span class="sd">        reactions at once. Deafault is False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        A morph with a new model, and essential_ids/removed)ids used to keep track of changes</span>
<span class="sd">    int (Only if get_count=True)</span>
<span class="sd">        process_count (number of models created, used for name managing)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (only relevant attributes shown):</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 5</span>
<span class="sd">        morph.essential_ids = None</span>
<span class="sd">        morph.removed_ids = None</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.process_reactions(morph, rxn_list=Client,removal_list(morph.rxn_labels[&#39;gene-no-match&#39;], list_range=(0, 10)))</span>

<span class="sd">    would process the 10 least likely gene-no-match reactions, which might produce a morph like this:</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 5</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>
<span class="sd">        morph.removed_ids = [&#39;rxn11123_c0&#39;, &#39;rxn34534_c0&#39;, &#39;rxn90565_c0&#39;, &#39;rxn78987_c0&#39;, &#39;rxn12321_c0&#39;, &#39;rxn89034_c0&#39;, &#39;rxn88888_c0&#39;]</span>

<span class="sd">    where removal of one of the reactions given by a key in morph.essential_ids would result in a model that has an objective value of 0.000 in FBA simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span>
    <span class="c"># Sort by probanno. items() returns (K, V=(model_index, prob))</span>
    <span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="c"># label argument behavior</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rxn_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">rxn_dict</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">]</span>
        <span class="n">removal_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rxn_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">get_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">removal_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rxn_dict</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">]</span>
        <span class="n">removal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rxn_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">get_key</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">removal_list</span> <span class="o">=</span> <span class="n">rxn_list</span>
    <span class="c"># instantiate lists only if needed</span>
    <span class="k">if</span> <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">morph</span><span class="o">.</span><span class="n">removed_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">morph</span><span class="o">.</span><span class="n">removed_ids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c">#Give objs a general name if none is provided</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;MM&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">removal_list</span><span class="p">)):</span>
        <span class="n">reaction_id</span> <span class="o">=</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;Reaction to remove: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">removal_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c">#TODO Find someway to fix the behaivior bug if model_id is not in ws, etc.</span>
        <span class="n">new_model_id</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">remove_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span><span class="n">ws</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_count</span><span class="p">),</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span><span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;reactions&#39;</span><span class="p">:[</span><span class="n">reaction_id</span><span class="p">]})[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">iterative_models</span><span class="p">:</span>
            <span class="n">process_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">fba_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;media&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">media</span><span class="p">,</span> <span class="s">&#39;media_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">mediaws</span><span class="p">}</span>
        <span class="n">fba_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fba&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;-FBA-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_count</span><span class="p">)),</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">ws</span><span class="p">,</span> <span class="s">&#39;model&#39;</span> <span class="p">:</span> <span class="n">new_model_id</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span><span class="n">ws</span><span class="p">,</span> <span class="s">&#39;formulation&#39;</span><span class="p">:</span> <span class="n">fba_formulation</span><span class="p">}</span>
        <span class="n">fbaMeta</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">runfba</span><span class="p">(</span><span class="n">fba_params</span><span class="p">)</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">fbaMeta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;Objective&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;FBA Flux: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flux</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="c"># removed successfully</span>
            <span class="k">print</span> <span class="s">&#39;Removed &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction_id</span><span class="p">)</span>
            <span class="n">morph</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">new_model_id</span>
            <span class="n">morph</span><span class="o">.</span><span class="n">removed_ids</span><span class="p">[</span><span class="n">reaction_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># essential</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; is Essential&#39;</span>
            <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span><span class="p">[</span><span class="n">reaction_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">removal_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">get_count</span><span class="p">:</span>
        <span class="k">return</span>  <span class="n">morph</span><span class="p">,</span> <span class="n">process_count</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="find_alternative"><a class="viewcode-back" href="../../modules.html#lib.Client.find_alternative">[docs]</a><span class="k">def</span> <span class="nf">find_alternative</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">reaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NOT FUNCTIONING AS DESIRED</span>

<span class="sd">    attemps to find an alternative to a reaction given by reaction item of the form (reaction_id, (model_index, probanno value))</span>

<span class="sd">    An example reaction_item would be morph.essential_ids.items()[0]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - reaction corresponds to a Reaction in morph.model</span>
<span class="sd">        - morph.probanno, morph.probannows form a valid ObjectIdentity for a readable RxnProbs object in KBase</span>
<span class="sd">        - morph.model, morph.ws_id forms a valid ObjectIdentity for a model object in KBase</span>
<span class="sd">        - morph.probhash is initialized to a dictionary of compartment truncated reaction_ids -&gt; probabilities</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        contains the morph.model from which will try to find an alternative to a particular reaction</span>
<span class="sd">    reaction: String (reaction_id)</span>
<span class="sd">        The reaction_id for a reaction to find a more likely alternative for</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph where morph,model, morph.ws_id is a valid ObjectIdentity for a model object in KBase</span>
<span class="sd">        (if a more likely alternative was found for reaction, this will be reflected in the model object)</span>
<span class="sd">    list</span>
<span class="sd">        new_reactions: a list of the new reactions considered as a potential alternatice to &#39;reaction&#39;</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form:</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 214</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        probhash: [&#39;rxn00001&#39;, &#39;rxn03434&#39;, &#39;rxn67834&#39; ... (more)]</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>

<span class="sd">    Below, morph.essential_ids.keys()[0] evaluates to &#39;rxn10316_c0&#39; as shown above</span>
<span class="sd">    &gt;&gt;&gt;morph, new_rxns = Client.find_alternative(morph, morph.essential_ids.keys()[0])</span>

<span class="sd">    would return:</span>

<span class="sd">        morph =</span>

<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 216</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        probhash: [&#39;rxn00001&#39;, &#39;rxn03434&#39;, &#39;rxn67834&#39; ... (more)]</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>

<span class="sd">        new_reactions =</span>

<span class="sd">        [&#39;rxn34343_c0&#39;, &#39;rxn 78923_c0&#39;, &#39;rxn00002_c0&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">model</span>
    <span class="n">ws_id</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">ws_id</span>
    <span class="n">fba_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;media&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">media</span><span class="p">,</span> <span class="s">&#39;media_workspace&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">mediaws</span><span class="p">}</span>
    <span class="c"># blacklist reactions we&#39;ve already removed and the one we are removing now</span>
    <span class="n">new_model_id</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">remove_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">model_id</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s">&#39;findalt&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction</span><span class="p">)),</span> <span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">reaction</span><span class="p">]})[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">removed_ids</span><span class="p">[</span><span class="n">reaction</span><span class="p">]</span> <span class="o">=</span> <span class="n">reaction_item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">blacklisted_rxns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">removed_ids</span><span class="p">]</span>
    <span class="n">gap_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;probabilisticAnnotation&#39;</span> <span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">probanno</span><span class="p">,</span> <span class="s">&#39;probabilisticAnnotation_workspace&#39;</span> <span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">probannows</span><span class="p">,</span> <span class="s">u&#39;formulation&#39;</span><span class="p">:</span> <span class="n">fba_formulation</span><span class="p">,</span> <span class="s">u&#39;blacklisted_rxns&#39;</span><span class="p">:</span><span class="n">blacklisted_rxns</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gap_formulation</span><span class="p">[</span><span class="s">&#39;blacklisted_rxns&#39;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="n">i</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">m</span><span class="o">.</span><span class="n">removed_ids</span><span class="p">[</span><span class="n">reaction</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">reaction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gap_formulation</span><span class="p">[</span><span class="s">&#39;blacklisted_rxns&#39;</span><span class="p">]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">new_model_id</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span> <span class="p">:</span> <span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;formulation&#39;</span> <span class="p">:</span> <span class="n">gap_formulation</span><span class="p">,</span> <span class="s">&#39;integrate_solution&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;gapFill&#39;</span> <span class="p">:</span> <span class="s">&#39;gf&#39;</span><span class="p">,</span> <span class="s">&#39;completeGapfill&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">gapfill_model</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">filled_model</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="n">ws_client</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">model_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.gffba&#39;</span><span class="p">,</span> <span class="s">&#39;wsid&#39;</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;workspace&#39;</span><span class="p">]}])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gapfill</span> <span class="o">=</span> <span class="nb">object</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;gapfillingSolutions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rxn_dicts</span> <span class="o">=</span> <span class="n">gapfill</span><span class="p">[</span><span class="s">&#39;gapfillingSolutionReactions&#39;</span><span class="p">]</span>
    <span class="n">gap_reactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="s">&#39;compartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rxn_dicts</span><span class="p">]</span>
    <span class="n">modelreactions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">m</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">reaction</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">:</span>
        <span class="n">modelreactions</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">new_reactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">gap_reactions</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modelreactions</span><span class="p">]</span>
    <span class="n">rmv_probability</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">probhash</span><span class="p">[</span><span class="n">reaction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">probsum</span>  <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_reactions</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">probhash</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">probsum</span> <span class="o">+=</span> <span class="n">prob</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">probhash</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">new_probability</span> <span class="o">=</span> <span class="n">probsum</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_reactions</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">new_probability</span> <span class="o">&gt;</span> <span class="n">rmv_probability</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">filled_model</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">rmv_probability</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">new_probability</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">new_reactions</span>
</div>
<div class="viewcode-block" id="probanno_optimization"><a class="viewcode-back" href="../../modules.html#lib.Client.probanno_optimization">[docs]</a><span class="k">def</span> <span class="nf">probanno_optimization</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deprecated, not maintained</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rxn_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">rxn_list</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="c">#Build Massive Probanno Hash. Consider doing this elsewhere</span>
    <span class="c">#Its actually not terribly massive, but 2000+ items is still too many to iterate over more than once</span>
    <span class="n">probhash</span><span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;probanno&#39;</span><span class="p">][</span><span class="s">&#39;reaction_probabilities&#39;</span><span class="p">]:</span>
        <span class="n">probhash</span><span class="p">[</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">rxn_list</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">reaction</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">model_id</span><span class="p">,</span> <span class="n">new_reactions</span> <span class="o">=</span> <span class="n">find_alternative</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="n">morph</span><span class="o">=</span><span class="n">morph</span><span class="p">)</span>
        <span class="n">rmv_probability</span> <span class="o">=</span> <span class="n">probhash</span><span class="p">[</span><span class="n">reaction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">probsum</span>  <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_reactions</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">i</span>
            <span class="k">print</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">probsum</span> <span class="o">+=</span> <span class="n">probhash</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c"># THIS NEEDS TO BE CHANGED IF YOU ARE SAVING THE HASH OUTSIDE OF</span>
                <span class="c"># THIS FUNCTION</span>
                <span class="n">probhash</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">new_probability</span> <span class="o">=</span> <span class="n">probsum</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_reactions</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">new_probability</span> <span class="o">&gt;</span> <span class="n">rmv_probability</span><span class="p">:</span>
            <span class="n">morph</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">rmv_probability</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">new_probability</span>
    <span class="k">return</span> <span class="n">morph</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">new_reactions</span><span class="p">,</span> <span class="n">probhash</span>


<span class="c"># Finishing/Cleanup  Steps</span></div>
<span class="k">def</span> <span class="nf">_finish</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">save_ws</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_ws</span><span class="p">:</span>
        <span class="n">ws_client</span><span class="o">.</span><span class="n">delete_workspace</span><span class="p">({</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Saved&#39;</span>

<span class="n">ws_client</span><span class="p">,</span> <span class="n">fba_client</span> <span class="o">=</span>  <span class="n">_init_clients</span><span class="p">()</span>

<div class="viewcode-block" id="get_morph_rxns"><a class="viewcode-back" href="../../modules.html#lib.Client.get_morph_rxns">[docs]</a><span class="k">def</span> <span class="nf">get_morph_rxns</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a list of all reactions in the model (by reaction_id)</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.model, morph.ws_id form a valid ObjectIdentity for a model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        morph which has the model to get reactions from</span>
<span class="sd">    label: String, optional</span>
<span class="sd">        pass a label to only get reactions of a certain type</span>
<span class="sd">        valid labels: essential, removed, gebe-no-match, gene-match, no-gene, recon</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        a list of reaction_ids in the morph&#39;s model. If a label parameter is set, only that specific type of reaction</span>
<span class="sd">        will be added to the list, If none exist, the empty list is returned</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form:</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 216</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        probhash: [&#39;rxn00001&#39;, &#39;rxn03434&#39;, &#39;rxn67834&#39; ... (more)]</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>

<span class="sd">    &gt;&gt;&gt;rxn_list = Client.get_morph_rxns(morph)</span>

<span class="sd">     would return a list of the form:</span>

<span class="sd">    [&#39;rxn00001_c0&#39;, &#39;rxn78786_c0&#39;, &#39;rxn45324_e0&#39; ... (more)]</span>

<span class="sd">    &gt;&gt;&gt;rxn_list = Client.get_morph_rxns(morph, label=&#39;gene-no-match&#39;)</span>

<span class="sd">    would return a list of the same form, and would be identical to morph.rxn_labels[&#39;gene-no-match&#39;].keys()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">modelobj</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">)</span>
        <span class="n">rxnlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">modelobj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">])):</span>
            <span class="n">mdlrxn</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s">&#39;modelreactions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">rxn_id</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;reaction_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="s">&#39;modelcompartment_ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># -1 index gets the last in the list</span>
            <span class="n">rxnlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rxn_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="s">&quot;essential&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">morph</span><span class="o">.</span><span class="n">essential_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="s">&quot;removed&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">morph</span><span class="o">.</span><span class="n">removed_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">morph</span><span class="o">.</span><span class="n">removed_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span></div>
<div class="viewcode-block" id="get_reactions"><a class="viewcode-back" href="../../modules.html#lib.Client.get_reactions">[docs]</a><span class="k">def</span> <span class="nf">get_reactions</span><span class="p">(</span><span class="n">reactions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns reaction info for given reactions in truncated compartment form, including definition and more</span>

<span class="sd">    Parmeters</span>
<span class="sd">    ---------</span>
<span class="sd">    reactions: list,(String) reaction_id</span>
<span class="sd">        a list of reaction_ids (compartment truncated) to get definition, equation, and other info on (will update this doc section to be more specific</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        a list of dictionaries where the keys are strings describing info about a reaction and the values are that information specific to a reaction</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt;rxn_info_list = Client.get_reactions([&#39;rxn00001&#39;, &#39;rxn54545&#39;,])</span>

<span class="sd">    &gt;&gt;&gt;rxn_info_list[0].keys()</span>
<span class="sd">    [u&#39;definition&#39;, u&#39;direction&#39;, u&#39;name&#39;, u&#39;enzymes&#39;, u&#39;equation&#39;, u&#39;deltaGErr&#39;, u&#39;reversibility&#39;, u&#39;abbrev&#39;, u&#39;deltaG&#39;, u&#39;id&#39;, u&#39;aliases&#39;]</span>

<span class="sd">    &gt;&gt;&gt;rxn_info_list[0][&#39;definition&#39;]</span>
<span class="sd">    u&#39;(1) H2O[c] + (1) PPi[c] &lt;=&gt; (2) Phosphate[c] + (2) H+[c]&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">get_reactions</span><span class="p">({</span><span class="s">&#39;reactions&#39;</span><span class="p">:</span><span class="n">reactions</span><span class="p">})</span></div>
<div class="viewcode-block" id="get_reaction"><a class="viewcode-back" href="../../modules.html#lib.Client.get_reaction">[docs]</a><span class="k">def</span> <span class="nf">get_reaction</span><span class="p">(</span><span class="n">reaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns reaction info for a given reaction in truncated compartment form, including definition and more</span>

<span class="sd">    Parmeters</span>
<span class="sd">    ---------</span>
<span class="sd">    reaction: String, reaction_id</span>
<span class="sd">        a reaction_id (compartment truncated) to get definition, equation, and other info on (will update this doc section to be more specific</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        a dictionary where the keys are strings describing info about a reaction and the values are that information specific to a reaction</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt;rxn_info = Client.get_reaction(&#39;rxn00001&#39;)</span>

<span class="sd">    &gt;&gt;&gt;rxn_info.keys()</span>
<span class="sd">    [u&#39;definition&#39;, u&#39;direction&#39;, u&#39;name&#39;, u&#39;enzymes&#39;, u&#39;equation&#39;, u&#39;deltaGErr&#39;, u&#39;reversibility&#39;, u&#39;abbrev&#39;, u&#39;deltaG&#39;, u&#39;id&#39;, u&#39;aliases&#39;]</span>

<span class="sd">    &gt;&gt;&gt;rxn_info[&#39;definition&#39;]</span>
<span class="sd">    u&#39;(1) H2O[c] + (1) PPi[c] &lt;=&gt; (2) Phosphate[c] + (2) H+[c]&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">get_reactions</span><span class="p">({</span><span class="s">&#39;reactions&#39;</span><span class="p">:[</span><span class="n">reaction</span><span class="p">]})</span></div>
<div class="viewcode-block" id="get_mdlrxn_info"><a class="viewcode-back" href="../../modules.html#lib.Client.get_mdlrxn_info">[docs]</a><span class="k">def</span> <span class="nf">get_mdlrxn_info</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">reaction_ids</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of dict() of informtation about reactions in the model and it&#39;s relation to the morph</span>

<span class="sd">    Returns a dictionary with the following information for each reaction specified. If no reaction_ids key</span>
<span class="sd">    word is set, examines all reactions in morph.model</span>

<span class="sd">    &#39;label&#39; - the morph classification of the reaction: (gene-match, gene-no-match, no-gene, recon)</span>
<span class="sd">    &#39;equation&#39; - the equation for the reaction returned in terms of compound_ids</span>
<span class="sd">    &#39;definition&#39; - the equation for the reaction returned in terms of coumpound names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allreactions</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">not_in_morph</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">reaction_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">all_reactions</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">reaction_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">reaction_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Make tuples like rxN_labels[key].items()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reaction_ids</span><span class="p">)):</span>
            <span class="n">rxn</span> <span class="o">=</span> <span class="n">reaction_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rxn</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">rxn</span><span class="p">]</span>
                    <span class="n">reaction_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rxn</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">reactions</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">get_reactions</span><span class="p">({</span><span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rxntup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rxntup</span> <span class="ow">in</span> <span class="n">reaction_ids</span><span class="p">]})</span>
    <span class="c"># WARNING: This assumes lists are identically ordered</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reaction_ids</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rxn</span> <span class="o">=</span> <span class="n">reactions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">i</span>
        <span class="n">mdlrxn</span> <span class="o">=</span> <span class="n">reaction_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;source_model&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;recon&#39;</span><span class="p">]):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s">&#39;recon_model&#39;</span><span class="p">]</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mdlrxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
               <span class="n">ans</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ans</span><span class="p">[</span><span class="s">&#39;definiton&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="s">&#39;definition&#39;</span><span class="p">]</span>
        <span class="n">ans</span><span class="p">[</span><span class="s">&#39;equation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="s">&#39;equation&#39;</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">mdlrxn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</div>
<div class="viewcode-block" id="remove_reactions_by_dict"><a class="viewcode-back" href="../../modules.html#lib.Client.remove_reactions_by_dict">[docs]</a><span class="k">def</span> <span class="nf">remove_reactions_by_dict</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes reactions provided in a dictionary of a style like morph.rxn_labels[&#39;gene-no-match&#39;] or morph.essential_ids</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">model</span>  <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">remove_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="s">&#39;removerxnsbydict&#39;</span><span class="p">,</span> <span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="n">rxn_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()})[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span></div>
<div class="viewcode-block" id="probanno_fill"><a class="viewcode-back" href="../../modules.html#lib.Client.probanno_fill">[docs]</a><span class="k">def</span> <span class="nf">probanno_fill</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    runs probabilistic gapfilling on morph.model</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.probanno, morph.probannows form a valid ObjectIdentity for a readable RxnProbs object in KBase</span>
<span class="sd">        - morph.media, morph.mediaws form a valid ObjectIdentity for a readable media object in KBase</span>
<span class="sd">        - morph.model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        A morph with model to be filled using probabilistic gapfilling</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph such that morph.model, morph.ws_id forms an ObjectIdentity for a probalistic gapfilled model in KBase (to media)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form:</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 214</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        probhash: [&#39;rxn00001&#39;, &#39;rxn03434&#39;, &#39;rxn67834&#39; ... (more)]</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        media: 18</span>
<span class="sd">        mediaws: 9145</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.probanno_fill(morph)</span>

<span class="sd">    Might return a morph of form</span>
<span class="sd">        ws_name: MMws235</span>
<span class="sd">        rxn_labels: [&#39;gene-match&#39;, &#39;gene-no-match&#39;, &#39;no-gene&#39;, &#39;recon&#39;]</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        morph.model = 216</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        probhash: [&#39;rxn00001&#39;, &#39;rxn03434&#39;, &#39;rxn67834&#39; ... (more)]</span>
<span class="sd">        probanno: 15</span>
<span class="sd">        morph.essential_ids = [&#39;rxn10316_c0&#39;, &#39;rxn23434_c0&#39;, &#39;rxn78687_c0&#39;]</span>
<span class="sd">        probannows: 9145</span>
<span class="sd">        media: 18</span>
<span class="sd">        mediaws: 9145</span>

<span class="sd">    Where morph.model now holds the object_id of a model filled to morph.media using porbabilistic gapfilling</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="c"># Gapfill the model and reset the model and modelws attributes of</span>
    <span class="c"># the morph</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">u&#39;morph-filled&#39;</span>
    <span class="n">fba_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;media&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">media</span><span class="p">,</span> <span class="s">&#39;media_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">mediaws</span><span class="p">}</span>
    <span class="n">gap_formulation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;probabilisticAnnotation&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probanno</span><span class="p">,</span> <span class="s">&#39;probabilisticAnnotation_workspace&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">probannows</span><span class="p">,</span> <span class="s">u&#39;formulation&#39;</span><span class="p">:</span> <span class="n">fba_formulation</span><span class="p">}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">u&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s">u&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">u&#39;out_model&#39;</span> <span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">u&#39;workspace&#39;</span> <span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">u&#39;formulation&#39;</span> <span class="p">:</span> <span class="n">gap_formulation</span><span class="p">,</span> <span class="s">u&#39;integrate_solution&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">u&#39;gapFill&#39;</span> <span class="p">:</span> <span class="s">u&#39;gf&#39;</span><span class="p">}</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">gapfill_model</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="remove_reactions"><a class="viewcode-back" href="../../modules.html#lib.Client.remove_reactions">[docs]</a><span class="k">def</span> <span class="nf">remove_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    remove the reactions in rxn_list from morph.model</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        the morph with the model reactions will be removed from</span>
<span class="sd">    rxn_list: list (String)</span>
<span class="sd">        a list of reaction_ids corresponding to reactions to be removed from the Morph</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph such that morph,model, morph.ws_id forms an ObjectIdentity for a KBase model object (the previous morph.model minus reactions in rxn_list)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (only relevant attributes shown):</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        model: 214</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.remove_reactons(morph, [&#39;rxn00001_c0&#39;, &#39;rxn11898_c0&#39;])</span>

<span class="sd">    Might return a morph of the form:</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        model: 216</span>

<span class="sd">    where morph.model, morph.ws_id forms an ObjectIdentity for a KBase model object (the previous model minus rxn00001_c0 and rxn11898_c0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">model</span>  <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">remove_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="s">&#39;removerxnsbydict&#39;</span><span class="p">,</span> <span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="n">rxn_list</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<div class="viewcode-block" id="remove_reaction"><a class="viewcode-back" href="../../modules.html#lib.Client.remove_reaction">[docs]</a><span class="k">def</span> <span class="nf">remove_reaction</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    remove the reaction rxn from morph.model</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - morph.model, morph.ws_id form a valid ObjectIdentity for a readable model object in KBase</span>
<span class="sd">        - morph.ws_id is the ID of a writeable KBase workspace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    morph: Morph</span>
<span class="sd">        the morph with the model reactions will be removed from</span>
<span class="sd">    rxn: String</span>
<span class="sd">        a reaction_id corresponding to a reaction to be removed from the Morph</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Morph</span>
<span class="sd">        a morph such that morph,model, morph.ws_id forms an ObjectIdentity for a KBase model object (the previous morph.model minus reaction rxn)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Given a morph of the form (only relevant attributes shown):</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        model: 214</span>

<span class="sd">    &gt;&gt;&gt;morph = Client.remove_reactons(morph, &#39;rxn11898_c0&#39;)</span>

<span class="sd">    Might return a morph of the form:</span>
<span class="sd">        ws_id: 11444</span>
<span class="sd">        model: 216</span>

<span class="sd">    where morph.model, morph.ws_id forms an ObjectIdentity for a KBase model object (the previous model minus rxn11898_c0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span><span class="o">.</span><span class="n">model</span>  <span class="o">=</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">remove_reactions</span><span class="p">({</span><span class="s">&#39;model&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;model_workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;workspace&#39;</span><span class="p">:</span> <span class="n">morph</span><span class="o">.</span><span class="n">ws_id</span><span class="p">,</span> <span class="s">&#39;output_id&#39;</span><span class="p">:</span> <span class="s">&#39;removerxnsbydict&#39;</span><span class="p">,</span> <span class="s">&#39;reactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rxn</span><span class="p">]})[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">morph</span>
</div>
<span class="k">def</span> <span class="nf">simple_probanno_morph</span><span class="p">(</span><span class="n">morph</span><span class="p">):</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">prepare_supermodel</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">fill_src</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">remove_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_list</span><span class="o">=</span><span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;gene-no-match&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">remove_reactions</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">rxn_list</span><span class="o">=</span><span class="n">morph</span><span class="o">.</span><span class="n">rxn_labels</span><span class="p">[</span><span class="s">&#39;no-gene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">morph</span> <span class="o">=</span> <span class="n">probanno_fill</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;simple_probanno_morph&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">morph</span>

<div class="viewcode-block" id="compare_morphmodels"><a class="viewcode-back" href="../../modules.html#lib.Client.compare_morphmodels">[docs]</a><span class="k">def</span> <span class="nf">compare_morphmodels</span><span class="p">(</span><span class="n">list_of_morphs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a detailed comparison of the models in a list of models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;models&#39;</span><span class="p">:[],</span> <span class="s">&#39;workspaces&#39;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_morphs</span><span class="p">:</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;models&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;workspaces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">ws_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fba_client</span><span class="o">.</span><span class="n">compare_models</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></div>
<span class="k">def</span> <span class="nf">prob_annotate</span><span class="p">(</span><span class="n">genome_id</span><span class="p">,</span> <span class="n">ws_id</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;to be implemented&quot;</span>
<span class="n">ws_client</span><span class="p">,</span> <span class="n">fba_client</span> <span class="o">=</span> <span class="n">_init_clients</span><span class="p">()</span>
<div class="viewcode-block" id="build_media"><a class="viewcode-back" href="../../modules.html#lib.Client.build_media">[docs]</a><span class="k">def</span> <span class="nf">build_media</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ws_id</span><span class="p">,</span> <span class="n">suppressError</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">objid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">isMinimal</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a KBase media object from a txt file in tab delimited format and saves it in a workspace</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Function Requirements:</span>
<span class="sd">        - `filename` is a valid path to a properly formatted text file representing a media object</span>
<span class="sd">        - `ws_id` corresponds to a KBase workspace you are authorized to write to</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename: String</span>
<span class="sd">        a String with the path to a txt file representing a media in tab-delimitted format. See MediaDB for an example</span>
<span class="sd">    ws_id: Integer</span>
<span class="sd">        a `workspace_id` for the media destination (can also be a string so long as the string represents an integer)</span>
<span class="sd">    suppressError: Boolean, optional</span>
<span class="sd">        a boolean flag for suppressing improperly formatted compound errors. Best used if one or more compounds does</span>
<span class="sd">        not have a kbase compound_id but they are NOT essential to the media. Default is `False`</span>
<span class="sd">    objid: Integer, optional</span>
<span class="sd">        a `object_id` for where to save the media (optional, for workspace system control)</span>
<span class="sd">    isMinimal: Boolean, optional</span>
<span class="sd">        a boolean indicating whether the given media is minimal. Default is `False`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (objid, wsid): ((Integer, Integer))</span>
<span class="sd">        An `object_id` and `workspace_id` in a tuple that correspond to the ObjectIdentity of the media in KBase</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Proper file format example:</span>
<span class="sd">        .. code-block::</span>
<span class="sd">            Compound    Concentration   Production_Bound(-)    Uptake_Bound(+)</span>
<span class="sd">            cpd00001[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00009[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00011[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00013[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00029[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00030[e0]    0.01    -1000.000000    1000.000000</span>
<span class="sd">            cpd00034[e0]    0.01    -1000.000000    1000.000000`</span>
<span class="sd">    - First Row is headers for the columns below</span>
<span class="sd">    - Each row is tab-delimitted (&#39;\\t&#39;), the 4th term ending with a new new</span>
<span class="sd">    line</span>

<span class="sd">    First, put a media txt file of the above form in a directory sucl as (relative) &#39;../media/mymedia.txt&#39;</span>

<span class="sd">    `&gt;&gt;&gt;Client.build_media(&#39;../media/mymedia.txt&#39;, 9145)`</span>
<span class="sd">    (15, 9145)</span>

<span class="sd">    &gt;&gt;&gt;`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">cpds</span> <span class="o">=</span>  <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cpds</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;cpd&quot;</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">item</span><span class="p">[</span><span class="s">u&#39;compound_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;489/6/1/compounds/id/&#39;</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">item</span><span class="p">[</span><span class="s">u&#39;concentration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">item</span><span class="p">[</span><span class="s">u&#39;minFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">item</span><span class="p">[</span><span class="s">u&#39;maxFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">compounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">suppressError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; not added to media!!&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MediaFormatError</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;is not a properly formed KBase compound_id&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;blankmedia.pkl&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">media</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">media</span><span class="p">[</span><span class="s">u&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">media</span><span class="p">[</span><span class="s">u&#39;source_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">isMinimal</span><span class="p">:</span>
        <span class="n">media</span><span class="p">[</span><span class="s">&#39;isMinimal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">media</span><span class="p">[</span><span class="s">u&#39;mediacompounds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compounds</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">Helpers</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">media</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">ws_id</span><span class="p">,</span> <span class="n">objid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

</div>
<span class="k">class</span> <span class="nc">MediaFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Model Morphing b1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Brendan King, Matt Richards, Vangelis Simeonidis, Nathan Price.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>